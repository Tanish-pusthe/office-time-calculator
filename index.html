<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Office Time Calculator</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #eef3ff;
        margin: 0;
        padding: 20px;
    }

    h2 {
        text-align: center;
        color: #304ffe;
        margin-bottom: 20px;
    }

    .container {
        max-width: 700px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }

    textarea {
        width: 100%;
        height: 240px;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #bfc7ff;
        font-size: 14px;
        background: #f7f9ff;
    }

    button {
        width: 100%;
        padding: 14px;
        margin-top: 15px;
        background: #304ffe;
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 16px;
        cursor: pointer;
    }

    button:hover {
        background: #1e39d6;
    }

    #result {
        margin-top: 25px;
        padding: 15px;
        background: #e9edff;
        border-radius: 8px;
        font-size: 16px;
    }

    p {
        margin: 8px 0;
    }
</style>
</head>

<body>

<h2>Office Time Calculator</h2>

<div class="container">
    <textarea id="logs" placeholder="Paste your punch logs here..."></textarea>
    <button onclick="processLogs()">Calculate</button>

    <div id="result"></div>
</div>

<script>
// Convert HH:MM:SS AM/PM → total seconds
function toSeconds(t) {
  const [time, mod] = t.split(" ");
  let [h, m, s] = time.split(":").map(Number);

  if (mod === "PM" && h !== 12) h += 12;
  if (mod === "AM" && h === 12) h = 0;

  return h * 3600 + m * 60 + (s || 0);
}

// Convert seconds → hh:mm:ss AM/PM
function to12h(sec) {
  sec = Math.max(0, sec);
  let h24 = Math.floor(sec / 3600) % 24;
  let m = Math.floor((sec % 3600) / 60);
  let s = sec % 60;

  const ap = h24 >= 12 ? "PM" : "AM";
  let h = h24 % 12;
  if (h === 0) h = 12;

  return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")} ${ap}`;
}

// Convert seconds → hh:mm:ss
function formatHMS(sec) {
  sec = Math.max(0, sec);
  let h = Math.floor(sec / 3600);
  let m = Math.floor((sec % 3600) / 60);
  let s = sec % 3600 % 60;
  return `${String(h).padStart(2,"0")}h ${String(m).padStart(2,"0")}m ${String(s).padStart(2,"0")}s`;
}

// Convert seconds → mm:ss
function formatMS(sec) {
  sec = Math.max(0, sec);
  let m = Math.floor(sec / 60);
  let s = sec % 60;
  return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}

function processLogs() {
  const text = document.getElementById("logs").value.trim();
  if (!text) return alert("Please paste logs");

  const lines = text.split(/\r?\n+/);
  let punches = [];
  let brk = 0;

  // Count break lines only
  for (let line of lines) {
    let match = line.match(/(\d{1,2})h\s*(\d{1,2})m\s*(\d{1,2})s/i);
    if (match) {
      let h = Number(match[1]), m = Number(match[2]), s = Number(match[3]);
      brk += h * 3600 + m * 60 + s;
    }
  }

  // Extract punch IN/OUT times
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i].trim();

    if (line.match(/AM|PM/)) {
      const time = line.replace(/[^0-9: AMP]/g, "");

      if (lines[i + 1] && lines[i + 1].includes("Punch In"))
        punches.push({ type: "IN", time });

      else if (lines[i + 1] && lines[i + 1].includes("Punch Out"))
        punches.push({ type: "OUT", time });
    }
  }

  punches = punches.reverse(); // oldest first

  let work = 0;

  // Calculate actual work (no auto break for gaps)
  for (let i = 0; i < punches.length - 1; i++) {
    const a = punches[i], b = punches[i + 1];

    if (a.type === "IN" && b.type === "OUT")
      work += toSeconds(b.time) - toSeconds(a.time);
  }

  const REQUIRED = 8 * 3600;
  const OFFICE_END = toSeconds("06:30:00 PM");

  const remainingWork = Math.max(REQUIRED - work, 0);
  const lastIn = punches.filter(p => p.type === "IN").pop();

  // FIX → allow logout after 6:30 PM
  let expected = toSeconds(lastIn.time) + remainingWork;

  // FIX → break remaining only meaningful if before 6:30 PM
  let breakRemaining = 0;
  if (expected < OFFICE_END) {
    breakRemaining = OFFICE_END - expected;
  }

  // Output
  document.getElementById("result").innerHTML = `
    <p><strong>Break Taken:</strong> ${formatHMS(brk)}</p>
    <p><strong>Break Remaining:</strong> ${formatMS(breakRemaining)}</p>
    <p><strong>Expected Punch Out:</strong> ${to12h(expected)}</p>
  `;
}
</script>

</body>
</html>
